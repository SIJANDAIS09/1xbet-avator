<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aviator - Epic Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Poppins:wght@600;800&display=swap" rel="stylesheet" />

<!-- Google Identity Services Library -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
  :root {
    --primary: #ff006e;
    --secondary: #3a86ff;
    --glow: #ff0a54;
    --text-glow: #ffffff;
    --bg-start: #0f001a;
    --bg-mid: #1a0033;
    --bg-end: #2d0055;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    min-height: 100vh;
    background: linear-gradient(135deg, var(--bg-start), var(--bg-mid), var(--bg-end));
    font-family: 'Poppins', sans-serif;
    color: white;
    overflow: hidden;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
  }

  /* Particles (same as before) */
  .particles { position: absolute; inset: 0; overflow: hidden; z-index: 1; }
  .particle { position: absolute; background: rgba(255, 255, 255, 0.15); border-radius: 50%; pointer-events: none; animation: float linear infinite; }
  @keyframes float { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-100px) scale(1); opacity: 0; } }

  /* Top logos */
  .top-logo { position: absolute; top: 15px; left: 15px; width: 60px; height: 60px; border-radius: 50%; overflow: hidden; border: 3px solid var(--primary); box-shadow: 0 0 20px var(--glow); cursor: pointer; z-index: 10; transition: all 0.4s; }
  .top-logo:hover { transform: rotate(360deg) scale(1.1); }
  .top-logo img { width: 100%; height: 100%; object-fit: cover; }

  .user-info { position: absolute; top: 15px; right: 15px; z-index: 10; font-size: clamp(0.9rem, 3vw, 1.2rem); display: flex; align-items: center; gap: 1rem; }
  .logout-btn { padding: 0.5rem 1rem; background: var(--primary); border: none; border-radius: 20px; color: white; cursor: pointer; font-weight: bold; }

  header { text-align: center; padding: 1rem; width: 100%; z-index: 5; margin-top: 70px; }
  .logo { display: flex; flex-direction: column; align-items: center; gap: 0.8rem; animation: glowPulse 4s infinite alternate; }
  .aviator-img { width: 100px; max-width: 140px; filter: drop-shadow(0 0 20px var(--primary)); animation: planeFly 6s infinite ease-in-out; }
  @keyframes planeFly { 0%, 100% { transform: translateX(-15px) rotate(-5deg); } 50% { transform: translateX(15px) rotate(5deg); } }
  .logo-text { font-family: 'Orbitron', sans-serif; font-size: clamp(2.5rem, 10vw, 5rem); font-weight: 900; letter-spacing: 0.15em; background: linear-gradient(90deg, var(--primary), var(--secondary), #ffea00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 30px var(--glow); }
  @keyframes glowPulse { from { filter: drop-shadow(0 0 15px var(--primary)); } to { filter: drop-shadow(0 0 35px var(--glow)); } }

  main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1.5rem; padding: 1rem; width: 100%; z-index: 5; }
  #multiplier { font-family: 'Orbitron', sans-serif; font-size: clamp(4rem, 18vw, 9rem); font-weight: 900; letter-spacing: 0.1em; text-shadow: 0 0 20px var(--text-glow), 0 0 40px var(--primary), 0 0 60px var(--glow); animation: multiplierPulse 2s infinite; }
  @keyframes multiplierPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
  #status-message { font-size: clamp(1.2rem, 5vw, 2rem); font-weight: 700; letter-spacing: 0.1em; text-shadow: 0 0 15px var(--secondary); text-align: center; padding: 0 1rem; }

  button#startBtn { padding: clamp(0.8rem, 4vw, 1.4rem) clamp(2.5rem, 10vw, 5rem); font-size: clamp(1.4rem, 6vw, 2.2rem); font-weight: 800; font-family: 'Orbitron', sans-serif; color: white; background: linear-gradient(45deg, var(--primary), var(--secondary)); border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 30px rgba(255, 0, 110, 0.4); transition: all 0.4s ease; position: relative; overflow: hidden; }
  button#startBtn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.6s; }
  button#startBtn:hover::before { left: 100%; }
  button#startBtn:hover { transform: translateY(-5px) scale(1.08); box-shadow: 0 20px 40px rgba(255, 0, 110, 0.6); }
  button#startBtn:disabled { background: #444; transform: none; box-shadow: none; cursor: not-allowed; opacity: 0.7; }

  footer { padding: 1rem; font-size: clamp(0.8rem, 2vw, 1rem); opacity: 0.8; text-align: center; width: 100%; z-index: 5; }

  .crash { animation: crashShake 0.6s ease-in-out; color: #ff006e !important; text-shadow: 0 0 40px #ff006e, 0 0 80px #ff006e; }
  @keyframes crashShake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); } 20%, 40%, 60%, 80% { transform: translateX(8px); } }

  /* Modal */
  .modal { display: flex; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 100; }
  .modal-content { background: rgba(20,0,40,0.9); padding: 2rem; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 0 40px var(--glow); animation: fadeIn 0.5s; }
  @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
  .modal h2 { margin-bottom: 1rem; font-family: 'Orbitron'; }
  .modal input { width: 100%; padding: 1rem; margin: 0.8rem 0; border: none; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; font-size: 1rem; }
  .modal button { padding: 1rem 2rem; background: var(--primary); border: none; border-radius: 20px; color: white; font-weight: bold; cursor: pointer; margin: 0.5rem; }
  .google-btn-container { margin: 1.5rem 0; }
  .switch-link { margin-top: 1rem; cursor: pointer; color: var(--secondary); }

  @media (max-width: 480px) {
    .top-logo { width: 50px; height: 50px; top: 10px; left: 10px; }
    header { margin-top: 60px; }
    .aviator-img { width: 80px; }
  }
</style>
</head>
<body>

<div class="particles" id="particles"></div>

<div class="top-logo" onclick="window.location.reload();">
  <img src="Screenshot_20240616-174545~2.png" alt="Aviator Logo" />
</div>

<div class="user-info" id="userInfo" style="display:none;">
  <span id="welcomeMsg"></span>
  <button class="logout-btn" id="logoutBtn">Logout</button>
</div>

<header>
  <div class="logo">
    <img src="ezgif.com-gif-maker.png" alt="Aviator Plane" class="aviator-img" />
    <div class="logo-text">AVIATOR</div>
  </div>
</header>

<main>
  <div id="multiplier">--</div>
  <div id="status-message">Press Start to Fly! üöÄ</div>
  <button id="startBtn" disabled>START</button>
</main>

<footer>
  &copy; Epic Aviator Simulation - With Google Sign-In
</footer>

<!-- Login Modal -->
<div class="modal" id="authModal">
  <div class="modal-content">
    <h2 id="modalTitle">Login</h2>
    
    <!-- Google Sign-In Button -->
    <div class="google-btn-container" id="googleBtn"></div>
    
    <div style="margin: 1.5rem 0; color: #aaa;">OR</div>
    
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <div>
      <button id="authBtn">Login</button>
    </div>
    <p class="switch-link" id="switchLink">Don't have an account? Register</p>
    <p id="errorMsg" style="color:red; margin-top:1rem;"></p>
  </div>
</div>

<script>
  // === Particles ===
  const particlesContainer = document.getElementById('particles');
  const particleCount = window.innerWidth < 768 ? 25 : 50;
  for (let i = 0; i < particleCount; i++) {
    const p = document.createElement('div');
    p.classList.add('particle');
    p.style.width = p.style.height = Math.random() * 6 + 3 + 'px';
    p.style.left = Math.random() * 100 + 'vw';
    p.style.animationDuration = Math.random() * 10 + 10 + 's';
    p.style.animationDelay = Math.random() * 5 + 's';
    particlesContainer.appendChild(p);
  }

  // === Auth Elements ===
  const modal = document.getElementById('authModal');
  const modalTitle = document.getElementById('modalTitle');
  const authBtn = document.getElementById('authBtn');
  const switchLink = document.getElementById('switchLink');
  const errorMsg = document.getElementById('errorMsg');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const googleBtnDiv = document.getElementById('googleBtn');

  const userInfo = document.getElementById('userInfo');
  const welcomeMsg = document.getElementById('welcomeMsg');
  const logoutBtn = document.getElementById('logoutBtn');

  const startBtn = document.getElementById('startBtn');
  const multiplierEl = document.getElementById('multiplier');
  const statusMessage = document.getElementById('status-message');

  let isLogin = true;
  let currentUser = null;

  // === Google Sign-In Setup ===
  // REPLACE WITH YOUR ACTUAL CLIENT ID FROM GOOGLE CLOUD CONSOLE!
  const GOOGLE_CLIENT_ID = "YOUR_GOOGLE_CLIENT_ID_HERE.apps.googleusercontent.com";

  function handleGoogleCredentialResponse(response) {
    // Decode JWT (no library needed)
    const payload = JSON.parse(atob(response.credential.split('.')[1]));
    const googleName = payload.name || payload.email.split('@')[0];
    const googleEmail = payload.email;

    // "Log in" with Google info
    currentUser = googleName + " (Google)";
    localStorage.setItem('currentUser', currentUser);
    localStorage.setItem('googleUserEmail', googleEmail); // optional extra info
    checkLogin();
    errorMsg.textContent = '';
  }

  // Render Google button when library loads
  window.onload = function () {
    if (GOOGLE_CLIENT_ID !== "YOUR_GOOGLE_CLIENT_ID_HERE.apps.googleusercontent.com") {
      google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleGoogleCredentialResponse
      });
      google.accounts.id.renderButton(googleBtnDiv, {
        theme: "outline",
        size: "large",
        text: "signin_with",
        shape: "rectangular",
        logo_alignment: "left"
      });
    } else {
      googleBtnDiv.innerHTML = "<p style='color:#ff6;'>‚ö†Ô∏è Add your Google Client ID to enable Google Sign-In</p>";
    }
  };

  // === Local Auth Logic ===
  function checkLogin() {
    currentUser = localStorage.getItem('currentUser');
    if (currentUser) {
      welcomeMsg.textContent = `Welcome, ${currentUser}!`;
      userInfo.style.display = 'flex';
      startBtn.disabled = false;
      statusMessage.textContent = "Press Start to Fly! üöÄ";
      modal.style.display = 'none';
    } else {
      modal.style.display = 'flex';
      startBtn.disabled = true;
      statusMessage.textContent = "Please log in to play";
    }
  }

  switchLink.onclick = () => {
    isLogin = !isLogin;
    modalTitle.textContent = isLogin ? 'Login' : 'Register';
    authBtn.textContent = isLogin ? 'Login' : 'Register';
    switchLink.textContent = isLogin ? "Don't have an account? Register" : "Already have an account? Login";
    errorMsg.textContent = '';
  };

  authBtn.onclick = () => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();
    errorMsg.textContent = '';

    if (!username || !password) {
      errorMsg.textContent = 'Please fill all fields';
      return;
    }

    let users = JSON.parse(localStorage.getItem('aviatorUsers')) || [];

    if (isLogin) {
      const user = users.find(u => u.username === username && u.password === password);
      if (user) {
        currentUser = username;
        localStorage.setItem('currentUser', currentUser);
        checkLogin();
      } else {
        errorMsg.textContent = 'Invalid username or password';
      }
    } else {
      if (users.find(u => u.username === username)) {
        errorMsg.textContent = 'Username already exists';
        return;
      }
      users.push({ username, password });
      localStorage.setItem('aviatorUsers', JSON.stringify(users));
      alert('Registration successful! Now login.');
      switchLink.click();
    }
  };

  logoutBtn.onclick = () => {
    localStorage.removeItem('currentUser');
    localStorage.removeItem('googleUserEmail');
    currentUser = null;
    checkLogin();
  };

  // === Game Logic ===
  let running = false;
  const animationSpeed = 0.012;

  function getRandomCrashPoint() {
    const r = Math.random();
    if (r < 0.7) return 1.1 + Math.random() * 0.4;
    if (r < 0.95) return 1.5 + Math.random() * 1.5;
    return 3.0 + Math.random() * 1.0;
  }

  function formatMultiplier(value) {
    return value.toFixed(2) + 'x';
  }

  function runGame() {
    if (running || !currentUser) return;
    running = true;
    startBtn.disabled = true;
    statusMessage.textContent = "Taking Off... üöÄ";
    multiplierEl.classList.remove('crash');

    let multiplier = 1.00;
    const crashPoint = getRandomCrashPoint();

    function step() {
      multiplier += animationSpeed;
      multiplierEl.textContent = formatMultiplier(multiplier);

      if (multiplier >= crashPoint) {
        multiplierEl.textContent = formatMultiplier(crashPoint);
        multiplierEl.classList.add('crash');
        statusMessage.textContent = `üí• CRASHED at ${formatMultiplier(crashPoint)}`;
        startBtn.disabled = false;
        running = false;
        return;
      }

      requestAnimationFrame(step);
    }

    requestAnimationFrame(step);
  }

  startBtn.addEventListener('click', runGame);

  // Init
  checkLogin();
</script>

</body>
</html>